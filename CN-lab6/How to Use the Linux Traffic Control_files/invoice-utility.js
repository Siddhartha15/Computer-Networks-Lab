
// ** Created by Josh on 08/10/17 **

// ##################################################
// DOCUMENTATION
// ##################################################
//
// NOTES ABOUT THIS MODULE
// * self-invoking function
// * no function is called internally on load (everything is called from js/pages/<file.js>)
// * follows the JS module pattern
// * these "library" modules are *always* loaded
// 
// on load main() is called,
// > and then calls and returns moduleExport(), 
// > which contains the desired functions to export
//
// contains utility functions related to the invoice, but
// > not apart of the main invoice-handler
//
// DOCUMENTATION
// ##################################################


NB_MODULES.InvoiceUtility = (function InvoiceUtil(_, $$, MODULES){
    'use strict';
    
    
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    // IMPORTS *********************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    
    const { _deepFreeze } = MODULES.NbImmutable;
    
    const { INPUT_VALID_CLASS } = MODULES.GeneralUtility;
    

    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    // LOGIC ***********************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    function readUserSelectedQuantities(){
        const planQuantities = {
            plan: $$.invoice.plans.quantity.text() || 0,
            wifiAddon: isWifiAddonSelected() ? '1' : '0',
        };
        const hardwareQuantities = _.mapObject($$.products, (obj,k) => obj.quantity.val() || 0);

        return _.mapObject(Object.assign({}, planQuantities, hardwareQuantities), (v,k) => parseInt(v));

    };
    
    
    // is the wifi addon selected in the dom
    function isWifiAddonSelected(){
        return $$.plans.addWifiOption.hasClass(INPUT_VALID_CLASS);
    };
    
    
    
    
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    // MAIN AND EXPORTS ************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    //******************************************************************************************************************************************
    function moduleExport(){
        return _deepFreeze({
            readUserSelectedQuantities,
        });
    };
    
    
    function main(){
        console.info("LOADING: invoice-utility.js");
        
        return moduleExport();
    }
    return main();



}(  _,
    NB_MODULES.JqueryCache,
    NB_MODULES,
));
